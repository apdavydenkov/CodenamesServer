<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codenames Server Statistics</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="font-sans bg-gray-100 min-h-screen p-5">
    <div class="max-w-[900px] mx-auto bg-white rounded-lg shadow-md overflow-hidden">
        <div class="bg-gray-800 text-white p-5 text-center">
            <h1 class="text-[1.5rem] md:text-3xl mb-1 font-medium">Codenames Server</h1>
            <p class="opacity-75 text-base">Статистика игрового сервера</p>
        </div>
        
        <!-- Сейчас онлайн -->
        <div class="border-b border-gray-200 py-[15px] px-5 md:px-[30px]">
            <h2 class="text-lg text-gray-800 mb-2 font-semibold">Сейчас онлайн</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="bg-white border border-gray-300 rounded p-4 text-center">
                    <h3 class="text-gray-600 text-sm mb-2 font-medium flex items-center justify-center gap-1"><i class="fas fa-gamepad"></i> Активные игры</h3>
                    <div class="stat-value text-3xl font-bold text-red-600" id="activeGames">-</div>
                </div>
                
                <div class="bg-white border border-gray-300 rounded p-4 text-center">
                    <h3 class="text-gray-600 text-sm mb-2 font-medium flex items-center justify-center gap-1"><i class="fas fa-chart-bar"></i> Игр за всё время</h3>
                    <div class="stat-value text-3xl font-bold text-purple-600" id="allTimeGames">-</div>
                </div>
            </div>
        </div>

        <!-- За сегодня -->
        <div class="border-b border-gray-200 py-[15px] px-5 md:px-[30px]">
            <h2 class="text-lg text-gray-800 mb-2 font-semibold">За сегодня</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="bg-white border border-gray-300 rounded p-4 text-center">
                    <h3 class="text-gray-600 text-sm mb-2 font-medium flex items-center justify-center gap-1"><i class="fas fa-plus-circle"></i> Игр создано</h3>
                    <div class="stat-value text-3xl font-bold text-blue-500" id="dailyGames">-</div>
                </div>
                
                <div class="bg-white border border-gray-300 rounded p-4 text-center">
                    <h3 class="text-gray-600 text-sm mb-2 font-medium flex items-center justify-center gap-1"><i class="fas fa-check-circle"></i> Игр завершено</h3>
                    <div class="stat-value text-3xl font-bold text-blue-500" id="dailyCompleted">-</div>
                </div>
            </div>
        </div>

        <!-- За неделю -->
        <div class="border-b border-gray-200 py-[15px] px-5 md:px-[30px]">
            <h2 id="weeklyTitle" class="text-lg text-gray-800 mb-2 font-semibold">За неделю</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="bg-white border border-gray-300 rounded p-4 text-center">
                    <h3 class="text-gray-600 text-sm mb-2 font-medium flex items-center justify-center gap-1"><i class="fas fa-plus-circle"></i> Игр создано</h3>
                    <div class="stat-value text-3xl font-bold text-green-500" id="weeklyGames">-</div>
                </div>
                
                <div class="bg-white border border-gray-300 rounded p-4 text-center">
                    <h3 class="text-gray-600 text-sm mb-2 font-medium flex items-center justify-center gap-1"><i class="fas fa-check-circle"></i> Игр завершено</h3>
                    <div class="stat-value text-3xl font-bold text-green-500" id="weeklyCompleted">-</div>
                </div>
            </div>
        </div>

        <!-- За месяц -->
        <div class="border-b border-gray-200 py-[15px] px-5 md:px-[30px] last:border-b-0">
            <h2 id="monthlyTitle" class="text-lg text-gray-800 mb-2 font-semibold">За месяц</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="bg-white border border-gray-300 rounded p-4 text-center">
                    <h3 class="text-gray-600 text-sm mb-2 font-medium flex items-center justify-center gap-1"><i class="fas fa-plus-circle"></i> Игр создано</h3>
                    <div class="stat-value text-3xl font-bold text-orange-500" id="monthlyGames">-</div>
                </div>
                
                <div class="bg-white border border-gray-300 rounded p-4 text-center">
                    <h3 class="text-gray-600 text-sm mb-2 font-medium flex items-center justify-center gap-1"><i class="fas fa-check-circle"></i> Игр завершено</h3>
                    <div class="stat-value text-3xl font-bold text-orange-500" id="monthlyCompleted">-</div>
                </div>
            </div>
        </div>
        
        <div class="bg-gray-50 py-[15px] px-5 md:px-[30px] border-t border-gray-300 flex flex-col md:flex-row justify-between items-center flex-wrap text-sm text-center md:text-left">
            <div class="my-1">
                <strong>Статус сервера:</strong> 
                <span class="text-green-500 font-semibold">● Онлайн</span>
            </div>
            <div class="my-1">
                <strong>Время работы:</strong> 
                <span id="uptime">-</span>
            </div>
            <div class="text-gray-600 my-1">
                Последнее обновление: <span id="lastUpdate">-</span>
            </div>
        </div>
    </div>

    <script>
        function formatUptime(seconds) {
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            if (days > 0) {
                return `${days}д ${hours}ч ${minutes}м`;
            } else if (hours > 0) {
                return `${hours}ч ${minutes}м`;
            } else {
                return `${minutes}м`;
            }
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });
        }
        
        function getWeekEndDate(startDateStr) {
            if (!startDateStr) return '';
            const startDate = new Date(startDateStr);
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 6);
            return endDate.toISOString().split('T')[0];
        }
        
        function getMonthName(month) {
            const months = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',
                          'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];
            return months[month - 1] || '';
        }
        
        function updateStats() {
            fetch('/stats')
                .then(response => response.json())
                .then(data => {
                    // Реальное время
                    document.getElementById('activeGames').textContent = data.activeGames || 0;
                    document.getElementById('allTimeGames').textContent = data.allTime?.totalGames || 0;
                    
                    // Дневная статистика
                    document.getElementById('dailyGames').textContent = data.daily?.gamesCreated || 0;
                    document.getElementById('dailyCompleted').textContent = data.daily?.gamesCompleted || 0;
                    
                    // Недельная статистика
                    document.getElementById('weeklyGames').textContent = data.weekly?.gamesCreated || 0;
                    document.getElementById('weeklyCompleted').textContent = data.weekly?.gamesCompleted || 0;
                    
                    // Обновляем заголовок недели
                    if (data.weekly?.startDate) {
                        const startDate = formatDate(data.weekly.startDate);
                        const endDate = formatDate(getWeekEndDate(data.weekly.startDate));
                        document.getElementById('weeklyTitle').textContent = `За неделю (${startDate} - ${endDate})`;
                    }
                    
                    // Месячная статистика
                    document.getElementById('monthlyGames').textContent = data.monthly?.gamesCreated || 0;
                    document.getElementById('monthlyCompleted').textContent = data.monthly?.gamesCompleted || 0;
                    
                    // Обновляем заголовок месяца
                    if (data.monthly?.month && data.monthly?.year) {
                        const monthName = getMonthName(data.monthly.month);
                        document.getElementById('monthlyTitle').textContent = `${monthName} ${data.monthly.year}`;
                    }
                    
                    // Время работы
                    document.getElementById('uptime').textContent = formatUptime(data.uptime || 0);
                    
                    // Время последнего обновления
                    document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
                })
                .catch(error => {
                    console.error('Error fetching stats:', error);
                });
        }
        
        // Обновляем статистику каждые 5 секунд
        updateStats();
        setInterval(updateStats, 5000);
    </script>
</body>
</html>